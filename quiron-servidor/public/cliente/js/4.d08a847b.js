(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"04da":function(e,t,a){"use strict";a("0710")},"0710":function(e,t,a){},"364e":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("q-list",{attrs:{bordered:"",padding:"",separator:""}},[a("q-item",[a("q-item-section",[a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("q-btn",{staticClass:"full-width q-px-xs",attrs:{label:"Buscar plantilla a editar",outline:""},on:{click:e.buscarPlantilla}})],1),a("div",{staticClass:"col"},[a("q-btn",{staticClass:"full-width q-px-xs",attrs:{label:"Buscar plantilla a copiar",outline:""},on:{click:e.clonarPlantilla}})],1)])])],1),a("q-item",[a("q-item-section",[a("mostrar-campo",{attrs:{etiqueta:"Identificador"}},[a("q-input",{attrs:{debounce:"1000",placeholder:"Identificador"},model:{value:e.plantilla.identificador,callback:function(t){e.$set(e.plantilla,"identificador",t)},expression:"plantilla.identificador"}})],1),a("mostrar-campo",{attrs:{etiqueta:"Serial"}},[e._v("\n          "+e._s(e.plantilla.serial)+"\n        ")]),a("mostrar-campo",{attrs:{etiqueta:"Version"}},[a("q-input",{attrs:{debounce:"1000",placeholder:"Version",type:"number"},model:{value:e.plantilla.version,callback:function(t){e.$set(e.plantilla,"version",t)},expression:"plantilla.version"}})],1)],1)],1),a("q-card",{staticClass:"q-ma-sm",staticStyle:{"{border-color":"#1D1D1D}"}},[a("q-card-section",[a("p",[e._v("Plantillas relacionadas")]),a("q-list",{attrs:{bordered:"",separator:""}},e._l(e.plantilla.relacionadas,(function(t,i){return a("q-item",{key:"rel-"+t.identificador,attrs:{clickable:""},on:{click:function(t){return e.quitarPlantillasRelacionada(i)}}},[a("q-item-label",[e._v(e._s(t.identificador+"::"+t.version))])],1)})),1)],1),a("q-card-actions",[a("q-btn",{staticClass:"full-width",attrs:{label:"Añadir plantilla relacionada",outline:""},on:{click:e.sumarPlantillaRelacionada}})],1)],1),a("q-expansion-item",{attrs:{"expand-separator":"","header-class":"collapsible",label:"Diseño","switch-toggle-side":""}},[a("seccion",{key:e.plantilla.serial+"raiz",attrs:{elemento:e.plantilla.modelo,indice:0,path:""}})],1),a("q-expansion-item",{attrs:{"expand-separator":"","header-class":"collapsible",label:"Previsualizacion","switch-toggle-side":""}},e._l(e.contexto,(function(t){return a("q-expansion-item",{key:e.obtenerKey(t),attrs:{"expand-separator":"",label:t.identificador,"switch-toggle-side":""}},[a("q-card",{attrs:{bordered:""}},[a("q-card-section",[a("previsualizador",{attrs:{plantilla:t}})],1)],1)],1)})),1),a("q-item",[a("q-item-section",[a("div",{staticClass:"row"},[a("q-btn",{class:e.unsavedChanges?["col","full-width","unsaved_changes"]:["col","full-width"],attrs:{label:"Cache"},on:{click:e.cache}}),a("q-btn",{staticClass:"col full-width",attrs:{label:"Descartar"},on:{click:e.discard}}),"crear"===e.accion?a("q-btn",{staticClass:"col full-width",attrs:{label:"Crear Plantilla"},on:{click:e.crearPlantilla}}):e._e(),"actualizar"===e.accion?a("q-btn",{staticClass:"col full-width",attrs:{label:"Actualizar Plantilla"},on:{click:e.actualizarPlantilla}}):e._e()],1)])],1)],1),a("q-inner-loading",{attrs:{showing:e.cargando}},[a("q-spinner-facebook",{attrs:{color:"primary",size:"50px"}}),e._v("\n    Cargando cache/plantilla\n  ")],1)],1)},n=[],l=a("60a3"),o=a("5bfb"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.plantilla.modelo!=={}?a("q-card",[a("q-card-section",{staticClass:"q-px-none"},e._l(e.plantilla.modelo.elementos,(function(t,i){return a("campo",{key:"pc-"+t.etiqueta,attrs:{data:e.compendio,elemento:t,path:e.plantilla.identificador,printable:!1}})})),1)],1):e._e()},s=[],c=a("9990"),d=a("6fc5"),p=a("868b"),u=function(e,t,a,i){var n,l=arguments.length,o=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(l<3?n(o):l>3?n(t,a,o):n(t,a))||o);return l>3&&o&&Object.defineProperty(t,a,o),o};let h=class extends l["e"]{constructor(){super(...arguments),this.data={},this.editorStore=Object(d["d"])(p["a"])}get compendio(){return this.editorStore.compendio}};u([Object(l["b"])()],h.prototype,"plantilla",void 0),h=u([Object(l["a"])({name:"previsualizador",components:{Campo:c["default"]}})],h);var f=h,v=f,m=a("2877"),g=a("f09f"),b=a("a370"),y=a("eebe"),q=a.n(y),C=Object(m["a"])(v,r,s,!1,null,null,null),_=C.exports;q()(C,"components",{QCard:g["a"],QCardSection:b["a"]});var w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.plantilla.modelo!=={}?a("q-card",[a("q-card-section",{staticClass:"q-px-none"},[a("div",[a("q-toolbar",{staticClass:"bg-indigo-11 shadow-11 q-mb-sm"},[a("q-pagination",{attrs:{"direction-links":!0,max:e.pages.length,"max-pages":5},model:{value:e.current_page,callback:function(t){e.current_page=t},expression:"current_page"}}),a("q-btn",{attrs:{icon:"add"},on:{click:e.addPage}}),a("q-space"),a("q-select",{staticClass:"element_selector",attrs:{options:e.opcionesListaElementos,"emit-value":"","map-options":"",placeholder:"Seleccione campo"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addElementoCanvas.apply(null,arguments)}},model:{value:e.selector_canvas,callback:function(t){e.selector_canvas=t},expression:"selector_canvas"}}),a("q-btn",{attrs:{icon:"add"},on:{click:e.addElementoCanvas}}),a("q-btn",{attrs:{icon:"aspect_ratio"},on:{click:e.addBlank}})],1),a("container",{staticClass:"bg-grey-4 a4",attrs:{bubbleUp:!0,cellSize:e.cell_size,defaultSize:e.default_size,layout:e.pages[e.current_page-1],maxColumnCount:400,id:"toPDF"},on:{"update:layout":function(t){return e.$set(e.pages,e.current_page-1,t)}}},[e._l(e.blanks_per_page[e.current_page-1],(function(e,t){return a("box",{key:t,staticClass:"bg-amber box_border",attrs:{boxId:t,resizeVisible:!1}})})),e._l(e.elements_per_page[e.current_page-1],(function(t){return a("box",{key:e.obtenerKey(t),staticClass:"box_border",attrs:{boxId:t.etiqueta,resizeVisible:!1}},[a("campo",{ref:"campos",refInFor:!0,staticClass:"campo",attrs:{elemento:t,path:"\\raiz",plantilla:e.plantilla_llena,printable:!0},nativeOn:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.test.apply(null,arguments)}}})],1)}))],2)],1)])],1):e._e()},k=[],x=a("9ea8"),P=a("b844"),O=a("6631"),$=function(e,t,a,i){var n,l=arguments.length,o=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(l<3?n(o):l>3?n(t,a,o):n(t,a))||o);return l>3&&o&&Object.defineProperty(t,a,o),o};let S=class extends l["e"]{constructor(){super(...arguments),this.plantilla_llena={},this.current_page=1,this.pages=[[]],this.elements_per_page=[[]],this.blanks_per_page=[[]],this.cell_size={w:1,h:1},this.default_size={w:100,h:20},this.captura="",this.selector_canvas=new P["Campo"]}get listaElementos(){let e=[];for(let t of this.plantilla.modelo.elementos)e.push(t),void 0!=t.elementos&&t.elementos.length>0&&(e=e.concat(this.recursionElementos(t)));return e}get opcionesListaElementos(){let e=[];return e.push({label:"Identificador",value:new P["Campo"](O["TiposElementos"]["entrada-texto"],"Identificador")}),e.push({label:"Serial",value:new P["Campo"](O["TiposElementos"]["entrada-texto"],"Serial")}),e.push({label:"Version",value:new P["Campo"](O["TiposElementos"]["entrada-texto"],"Version")}),e=e.concat(this.listaElementos.map((e=>({label:e.etiqueta,value:e})))),e}test(){}recursionElementos(e){let t=[];for(let a of e.elementos)t.push(a),void 0!=a.elementos&&a.elementos.length>0&&(t=t.concat(this.recursionElementos(a)));return t}obtenerKey(e){return e.elementos?e.etiqueta+e.elementos.length:e.etiqueta}addElementoCanvas(){this.elements_per_page[this.current_page-1].push(this.selector_canvas),this.selector_canvas=new P["Campo"]}addBlank(){this.blanks_per_page[this.current_page-1].push({})}addPage(){this.current_page=this.pages.length,this.$set(this.pages,this.current_page,[]),this.$set(this.elements_per_page,this.current_page,[]),this.$set(this.blanks_per_page,this.current_page,[]),this.current_page++}};$([Object(l["b"])()],S.prototype,"plantilla",void 0),S=$([Object(l["a"])({name:"previsualizador",components:{Campo:c["default"],Container:x["Container"],Box:x["Box"]}})],S);var z=S,j=z,I=(a("04da"),a("65c6")),E=a("3b16"),Q=a("9c40"),D=a("2c91"),T=a("ddd8"),V=Object(m["a"])(j,w,k,!1,null,null,null),R=V.exports;q()(V,"components",{QCard:g["a"],QCardSection:b["a"],QToolbar:I["a"],QPagination:E["a"],QBtn:Q["a"],QSpace:D["a"],QSelect:T["a"]});var A=a("e2c2"),B=a("c8a8"),L=a.n(B),K=a("75a0"),F=function(e,t,a,i){function n(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,l){function o(e){try{s(i.next(e))}catch(t){l(t)}}function r(e){try{s(i["throw"](e))}catch(t){l(t)}}function s(e){e.done?a(e.value):n(e.value).then(o,r)}s((i=i.apply(e,t||[])).next())}))};class U{constructor(e,t){this.history=null,this.window=0,this.cacheType=e,this.cacheClass=t}isArray(e){return Array.isArray(e)}static isObject(e){return!Array.isArray(e)}syncToServer(){return F(this,void 0,void 0,(function*(){try{const e=yield K["a"].get(`cache/${this.cacheType}`,void 0,this.cacheClass);return this.isArray(e)&&(this.history=e,this.window=e.length),!0}catch(e){return console.log(e),!1}}))}getValue(){return F(this,void 0,void 0,(function*(){return null==this.history&&(yield this.syncToServer()),this.history.length>0?this.history[this.history.length-1]:new this.cacheClass({})}))}cache(e){return F(this,void 0,void 0,(function*(){try{this.history.push(Object.assign(new this.cacheClass({}),e)),yield this.saveToServer(e)}catch(t){throw t}}))}saveToServer(e){return F(this,void 0,void 0,(function*(){try{const t={elemento:e};yield K["a"].post(`cache/${this.cacheType}`,t,void 0,this.cacheClass)}catch(t){throw t}}))}discardCache(){return F(this,void 0,void 0,(function*(){try{yield K["a"].delete(`cache/${this.cacheType}`,void 0)}catch(e){console.log(e)}}))}materializeCache(){return F(this,void 0,void 0,(function*(){try{const e=yield this.getValue();if(e)switch(this.cacheType){case"plantilla":return yield K["a"].post("plantilla",{plantilla:e})}}catch(e){console.log(e)}}))}}var J=a("0462"),N=function(e,t,a,i){var n,l=arguments.length,o=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(l<3?n(o):l>3?n(t,a,o):n(t,a))||o);return l>3&&o&&Object.defineProperty(t,a,o),o},M=function(e,t,a,i){function n(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,l){function o(e){try{s(i.next(e))}catch(t){l(t)}}function r(e){try{s(i["throw"](e))}catch(t){l(t)}}function s(e){e.done?a(e.value):n(e.value).then(o,r)}s((i=i.apply(e,t||[])).next())}))};let G=class extends l["e"]{constructor(){super(...arguments),this.plantilla=new L.a({}),this.plantillaUnica={},this.cargando=!1,this.unsavedChanges=!1,this.controladorPlantilla=new U("plantilla",L.a),this.editorStore=Object(d["d"])(p["a"])}crearCache(){return M(this,void 0,void 0,(function*(){yield this.controladorPlantilla.saveToServer(this.plantilla)}))}get accion(){return""!=this.plantilla.serial?"actualizar":"crear"}get contexto(){return this.editorStore.contexto}onRaizChanged(){return M(this,void 0,void 0,(function*(){""!=this.plantilla.identificador&&(this.unsavedChanges=!0);const e=[...this.plantilla.relacionadas,this.plantilla];this.editorStore.setContexto(e)}))}saveCache(){return M(this,void 0,void 0,(function*(){if(""!=this.plantilla.identificador)try{yield this.controladorPlantilla.cache(this.plantilla),this.$q.notify({message:"Cache actualizada.",timeout:700,closeBtn:"Cerrar"}),this.unsavedChanges=!1}catch(e){}else this.$q.notify("No se puede guardar una plantilla en cache sin identificador.")}))}cache(){return M(this,void 0,void 0,(function*(){yield this.saveCache()}))}reiniciarDatos(){this.plantilla=new L.a({}),this.plantillaUnica={"\\raiz":"seccion"},this.unsavedChanges=!1}sumarPlantillaRelacionada(){let e={campos_busqueda:[{etiqueta:"Identificador",valor:"identificador"},{etiqueta:"Serial",valor:"serial"}],campos_presentacion:[{etiqueta:"Identificador",valor:"identificador"},{etiqueta:"Serial",valor:"serial"},{etiqueta:"Version",valor:"version"}],opciones_busqueda:{}};this.$q.dialog({component:A["a"],parent:this,endpoint:"plantilla",clase:L.a,opciones:e,persistent:!0}).onOk((e=>{this.plantilla.relacionadas.push(e)})).onCancel((e=>{console.log(e)}))}quitarPlantillasRelacionada(e){this.$delete(this.plantilla.relacionadas,e)}buscarPlantilla(){let e={campos_busqueda:[{etiqueta:"Identificador",valor:"identificador"},{etiqueta:"Serial",valor:"serial"}],campos_presentacion:[{etiqueta:"Identificador",valor:"identificador"},{etiqueta:"Serial",valor:"serial"},{etiqueta:"Version",valor:"version"}],opciones_busqueda:{}};this.$q.dialog({component:A["a"],parent:this,endpoint:"plantilla",clase:L.a,opciones:e,persistent:!0}).onOk((e=>{this.plantilla=e})).onCancel((e=>{console.log(e)}))}actualizarClonacion(e,t){console.log(t);for(const a of t.elementos)if(a.elemento==O["TiposElementos"].seccion)this.actualizarClonacion(e,a);else{if(a.referencia.activated){const t=a.referencia.identificador.indexOf("/");a.referencia.identificador=e+a.referencia.identificador.substring(t)}if(a.dependiente.activated)for(const t of a.dependiente.conditions){const a=t.parent.indexOf("/");t.parent=e+t.parent.substring(a)}}}clonarPlantilla(){let e={campos_busqueda:[{etiqueta:"Identificador",valor:"identificador"},{etiqueta:"Serial",valor:"serial"}],campos_presentacion:[{etiqueta:"Identificador",valor:"identificador"},{etiqueta:"Serial",valor:"serial"},{etiqueta:"Version",valor:"version"}],opciones_busqueda:{}};this.$q.dialog({component:A["a"],parent:this,endpoint:"plantilla",clase:L.a,opciones:e,persistent:!0}).onOk((e=>{e.serial="",this.$q.dialog({message:"Nuevo nombre de la plantilla",prompt:{model:e.identificador,type:"text",isValid:e=>""!==e}}).onOk((t=>{e.identificador;e.identificador=t,this.actualizarClonacion(t,e.modelo),this.plantilla=e}))})).onCancel((e=>{console.log(e)}))}crearPlantilla(){return M(this,void 0,void 0,(function*(){if(""!=this.plantilla.identificador&&void 0!=this.plantilla.identificador)try{this.$q.dialog({title:"Crear Plantilla",message:"¿Esta seguro que desea crear la plantilla actual?",cancel:"Cancelar",persistent:!0}).onOk((()=>M(this,void 0,void 0,(function*(){try{yield this.controladorPlantilla.cache(this.plantilla);let e=yield this.controladorPlantilla.materializeCache();this.$q.dialog({title:"Confirmacion de creacion",message:`<p>Identificador: ${e.object.identificador}</p><p>Serial: ${e.object.serial}</p><p>Version: ${e.object.version}</p><h5>Codigo confirmacion: ${e.logID}</h5>`,html:!0,persistent:!0,dark:!0}).onOk((()=>{})),this.reiniciarDatos()}catch(e){this.$q.notify(e.toString()),console.log(e)}}))))}catch(e){console.log(e)}else this.$q.notify("Toda plantilla debe tener un identificador")}))}actualizarPlantilla(){return M(this,void 0,void 0,(function*(){if(""!=this.plantilla.identificador&&void 0!=this.plantilla.identificador)try{this.$q.dialog({title:"Actualizar Plantilla",message:"¿Esta seguro que desea actualizar la plantilla actual?",cancel:"Cancelar",persistent:!0}).onOk((()=>M(this,void 0,void 0,(function*(){try{yield this.controladorPlantilla.cache(this.plantilla);let e=yield this.controladorPlantilla.materializeCache();console.log(e),this.$q.dialog({title:"Confirmacion de actualizacion",message:`<p>Identificador: ${e.object.identificador}</p><p>Serial: ${e.object.serial}</p><p>Version: ${e.object.version}</p><h5>Codigo confirmacion: ${e.logID}</h5>`,html:!0,persistent:!0,dark:!0}).onOk((()=>{})),this.reiniciarDatos()}catch(e){this.$q.notify(e.toString()),console.log(e)}}))))}catch(e){console.log(e)}else this.$q.notify("Toda plantilla debe tener un identificador")}))}discard(){this.$q.dialog({title:"Descartar Plantilla",message:"¿Esta seguro que desea eliminar la plantilla actual? esta accion no se puede deshacer.",cancel:"Cancelar",persistent:!0}).onOk((()=>M(this,void 0,void 0,(function*(){try{yield this.controladorPlantilla.discardCache(),this.reiniciarDatos(),this.$q.notify("Plantilla descartada correctamente")}catch(e){this.$q.notify("Ocurrio un error en el servidor.")}}))))}mounted(){return M(this,void 0,void 0,(function*(){try{let e=yield this.controladorPlantilla.getValue();e?this.plantilla=e:0!=this.id&&(this.plantilla=yield this.controladorPlantilla.getValue())}catch(e){console.log(e),this.$q.notify("Ocurrio un error en el servidor.")}this.cargando=!1}))}obtenerKey(e){return"preview"+Date.now()+e.serial}};N([Object(l["b"])()],G.prototype,"id",void 0),N([Object(l["f"])("plantilla",{deep:!0})],G.prototype,"onRaizChanged",null),G=N([Object(l["a"])({components:{Previsualizador:_,Disposicion:R,MostrarCampo:o["a"],Seccion:J["c"]}})],G);var H=G,W=H,X=(a("3863"),a("9989")),Y=a("1c1c"),Z=a("66e5"),ee=a("4074"),te=a("27f9"),ae=a("0170"),ie=a("4b7e"),ne=a("3b73"),le=a("74f7"),oe=a("e669"),re=Object(m["a"])(W,i,n,!1,null,null,null);t["default"]=re.exports;q()(re,"components",{QPage:X["a"],QList:Y["a"],QItem:Z["a"],QItemSection:ee["a"],QBtn:Q["a"],QInput:te["a"],QCard:g["a"],QCardSection:b["a"],QItemLabel:ae["a"],QCardActions:ie["a"],QExpansionItem:ne["a"],QInnerLoading:le["a"],QSpinnerFacebook:oe["a"]})},3863:function(e,t,a){"use strict";a("fc81")},fc81:function(e,t,a){}}]);